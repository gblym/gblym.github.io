---
layout: post
title: 贝塞尔曲线的升阶
abstract: 贝塞尔曲线是是一种常见于绘图软件中的参数曲线，我们可以将一条n次贝塞尔曲线升阶为一条n+k次贝塞尔曲线并且不改变曲线形状。
tags: Math Graphic Bezier
---

> 一条二次贝塞尔曲线能否转换成对应的三次贝塞尔曲线，并且两条曲线严格重合（而不是拟合）？

我看到这个问题的第一反应：“把中间的控制点复制一份不就行了嘛”，但仔细一想<del>细思恐极</del>似乎哪里不对。事实上，这样做相当于改变了控制点的权重，会将曲线“吸”向控制点。

直觉告诉我，这个问题的答案虽然不能想当然，但应该是可行的。于是自己动笔，丰衣足食。

贝塞尔曲线的性质
---

从定义讲起。贝塞尔曲线是一种借助若干个控制点定义的参数曲线。由`n+1`个控制点定义的贝塞尔曲线称为`n`次贝塞尔曲线。我们在绘图软件中经常会看到它，例如Windows的“画图”工具中的曲线，就是一条三次贝塞尔曲线。

以三次贝塞尔曲线为例，令控制点为`P0`、`P1`、`P2`、`P3`。我们定义一个0到1之间的参数`t`，将直线`P0-P1`划分为`t:(1-t)`的两部分，令分界点为`Q01`，同理得到`Q12`和`Q23`；再划分`Q01`和`Q12`得到`R02`，同理得到`R13`；最后划分`R02`和`R13`得到`S`，这就是贝塞尔曲线上的一个点。取遍所有`t`得到的点`S`的集合，即可得到一条贝塞尔曲线。

![贝塞尔曲线图解](/images/2014-07-16-bezier-curve.gif)

我们很容易发现，贝塞尔曲线上的任意一个点都是控制点的线性组合，每个点的坐标都可以表达为：

`B(t)=k0*P0+k1*P1+k2*P2...+kn*Pn`，其中`k0+k1+k2...+kn=1`

（事实上，系数是：`ki=nCi*t^(n-i)*(1-t)^i`）

因此，我们可以对贝塞尔曲线和它的控制点进行线性变换（更进一步地，进行放射变换），得到的新曲线就是由变换后的控制点定义的贝塞尔曲线。

二次转三次
---

//注：将本节内容脑补为cosplay的请自行面壁。

首先，考虑到贝塞尔曲线可以和控制点一起进行线性变换，我们可以通过线性变换和平移，使二次贝塞尔曲线的三个控制点位于`(1,0)`、`(0,0)`和`(0,1)`。

那么，这条二次贝塞尔曲线就是：

`B2(t)=(1,0)*t^2+(0,1)*(1-t)^2`

也就是说：

`x=t^2`

`y=(1-t)^2`

然后我们考虑对应的三次贝塞尔曲线。

由于第二个和倒数第二个控制点分别决定了曲线在两个端点处的切线方向（读者可以动笔验证一下，这对于绘图软件来说是一个非常有用的性质），要让两条曲线重合，这两个控制点必须分别在直线`y=0`和`x=0`上。

再考虑到函数图像和控制点关于`y=x`对称，我们可以令四个控制点分别为：`(1,0)`、`(a,0)`、`(0,a)`、`(0,1)`。

得到曲线的表达式：

`B3(t)=（1,0)*t^3+(a,0)*3t^2*(1-t)+(0,a)*3t*(1-t)^2+(0,1)*(1-t)^3`

代入曲线上的一个点`(1/4,1/4)`，求得`a=1/3`。

因此三次贝塞尔曲线的控制点为`(1,0)`、`(1/3,0)`、`(0,1/3)`、`(0,1)`，有：

`x=t^3+t^2*(1-t)=t^2`

`y=(1-t)^3+(1-t)^2*t=(1-t)^2`

和二次贝塞尔曲线的表达式完全相同，可知它们是重合的。

再考虑变换，任意的二次贝塞尔都可以用相同的方式转换成三次贝塞尔曲线。只需要在相邻控制点（`P0`与`P1`、`P1`与`P2`）之间的连线上，靠近中间控制点（`P1`）的`1/3`处取新的控制点就可以了。

推广
---

升阶同样适用于更高阶的贝塞尔曲线。

考虑从`n`阶升到`n+1`阶。

由于`Bi=Bi*t+Bi*(1-t)`，我们可以将贝塞尔曲线的表达式代入，并将关于`t`的部分提取出来。令新曲线的第i个点为P，原曲线的第i-1个点为Q，第i个点为R：

`k'i*P=k'i*i*Q/(n+1)+k'i*(n+1-i)*R/(n+1)`

因此：

`P=i/(n+1)*Q+(n+1-i)/(n+1)*R`

我们可以进一步推出，从`n`阶升到`n+r`阶的公式是：

`P=sum(Pj*nCj*rC(i-j)/(n+r)Ci)`
